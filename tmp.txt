import os
import json
from pathlib import Path

def extract_qa_from_json(json_path):
    """从单个JSON文件中提取question和answer字段"""
    try:
        with open(json_path, 'r', encoding='utf-8') as f:
            data = json.load(f)
        # 提取目标字段[2,6](@ref)
        return {
            "question": data.get("question", ""),
            "answer": data.get("answer", "")
        }
    except (json.JSONDecodeError, KeyError) as e:
        print(f"解析失败 {json_path}: {str(e)}")
        return None

def process_directory_to_jsonl(input_dir, output_file):
    """处理目录下所有JSON文件并生成JSONL"""
    jsonl_data = []
    
    # 递归遍历所有JSON文件[3,12](@ref)
    for root, _, files in os.walk(input_dir):
        for file in files:
            if file.endswith('.json'):
                file_path = os.path.join(root, file)
                qa_data = extract_qa_from_json(file_path)
                if qa_data:
                    jsonl_data.append(qa_data)
    
    # 写入JSONL文件[9,10](@ref)
    with open(output_file, 'w', encoding='utf-8') as f_out:
        for item in jsonl_data:
            f_out.write(json.dumps(item, ensure_ascii=False) + '\n')
    
    print(f"成功处理 {len(jsonl_data)} 个JSON文件 → {output_file}")

if __name__ == "__main__":
    # 配置路径
    input_directory = "./your_json_folder"  # 替换为JSON文件夹路径
    output_jsonl = "qa_dataset.jsonl"      # 输出文件名
    
    # 执行转换
    process_directory_to_jsonl(input_directory, output_jsonl)
